# ⏰ Reality游戏时间系统设计

> 设计版本：2.0
> 创建时间：2024-12-28

## 📅 年历系统设计

### 基础结构
```
一年 = 180天
一季 = 45天（3个月）
一月 = 15天
一天 = 24小时
一小时 = 60分钟
```

### 季节月份分配
| 季节 | 月份 | 天数范围 | 游戏内特点 |
|-----|------|---------|-----------|
| 🌸 春季 | 3月、4月、5月 | 1-45天 | 万物复苏、樱花、温暖 |
| ☀️ 夏季 | 6月、7月、8月 | 46-90天 | 炎热、暑假、海边 |
| 🍂 秋季 | 9月、10月、11月 | 91-135天 | 落叶、丰收、凉爽 |
| ❄️ 冬季 | 12月、1月、2月 | 136-180天 | 雪天、新年、寒冷 |

### 详细月份对照表
| 月份 | 所属季节 | 年内天数范围 | 特殊日子 |
|-----|---------|------------|---------|
| 1月 | 冬季 | 151-165 | 新年(1月1日) |
| 2月 | 冬季 | 166-180 | 情人节(2月14日) |
| 3月 | 春季 | 1-15 | 开学季 |
| 4月 | 春季 | 16-30 | 樱花节 |
| 5月 | 春季 | 31-45 | 春游 |
| 6月 | 夏季 | 46-60 | 期末考试 |
| 7月 | 夏季 | 61-75 | 暑假开始 |
| 8月 | 夏季 | 76-90 | 夏日祭 |
| 9月 | 秋季 | 91-105 | 秋季学期 |
| 10月 | 秋季 | 106-120 | 万圣节(10月15日) |
| 11月 | 秋季 | 121-135 | 感恩节 |
| 12月 | 冬季 | 136-150 | 圣诞节(12月15日) |

## 🕐 时间推进机制

### 自然时间流速
- **默认速度**：1游戏分钟 = 1秒现实时间
- **快进模式**：睡觉/等待时 x60 速度
- **暂停模式**：对话/菜单时暂停

### 行动消耗时间
| 行动类型 | 消耗时间 | 示例 |
|---------|---------|------|
| 移动 | 10-30分钟 | 教室→食堂(10分) |
| 对话 | 5-30分钟 | 简单对话(5分) |
| 上课 | 45分钟 | 一节课 |
| 用餐 | 20-30分钟 | 午餐(30分) |
| 睡眠 | 6-8小时 | 夜晚休息 |
| 探索 | 30-60分钟 | 调查场景 |

## 🌅 时间段系统

### 日常时间段
| 时间段 | 时间范围 | 图标 | 特点 |
|-------|---------|------|------|
| 凌晨 | 00:00-05:59 | 🌃 | 深夜、大部分NPC睡觉 |
| 早晨 | 06:00-08:59 | 🌅 | 起床、早餐、上学 |
| 上午 | 09:00-11:59 | 🌞 | 上课、工作 |
| 中午 | 12:00-13:59 | ☀️ | 午餐、休息 |
| 下午 | 14:00-17:59 | 🌤️ | 下午课程、活动 |
| 傍晚 | 18:00-20:59 | 🌇 | 晚餐、自由活动 |
| 夜晚 | 21:00-23:59 | 🌙 | 休息、夜生活 |

## 📊 数据结构设计

### TimeData对象
```javascript
{
    // 绝对时间（核心）
    totalMinutes: 10950,    // 总分钟数（从游戏开始）

    // 计算得出的时间
    year: 1,                // 第几年
    month: 3,               // 月份(1-12)
    day: 8,                 // 月内第几天(1-15)
    dayOfYear: 8,           // 年内第几天(1-180)
    hour: 7,                // 小时(0-23)
    minute: 30,             // 分钟(0-59)

    // 衍生信息
    season: 'spring',       // 季节
    weekday: 3,             // 星期几(1-7)
    period: 'morning',      // 时间段
    weather: 'sunny'        // 当前天气
}
```

### 计算公式
```javascript
// 从总分钟数计算各项
year = Math.floor(totalMinutes / (180 * 24 * 60)) + 1
dayOfYear = Math.floor((totalMinutes % (180 * 24 * 60)) / (24 * 60)) + 1
hour = Math.floor((totalMinutes % (24 * 60)) / 60)
minute = totalMinutes % 60

// 从年内天数计算月份
if (dayOfYear <= 45) {
    season = 'spring'
    month = Math.ceil(dayOfYear / 15) + 2  // 3,4,5月
} else if (dayOfYear <= 90) {
    season = 'summer'
    month = Math.ceil((dayOfYear - 45) / 15) + 5  // 6,7,8月
} else if (dayOfYear <= 135) {
    season = 'autumn'
    month = Math.ceil((dayOfYear - 90) / 15) + 8  // 9,10,11月
} else {
    season = 'winter'
    if (dayOfYear <= 150) {
        month = 12  // 12月
    } else {
        month = Math.ceil((dayOfYear - 150) / 15)  // 1,2月
    }
}
```

## 🎮 功能特性

### 1. 时间相关事件
- **节日活动**：特定日期触发特殊剧情
- **季节变化**：景色、NPC服装、可用活动改变
- **作息规律**：NPC按时间移动和改变状态

### 2. 时间控制
- **等待功能**：快速跳过到指定时间
- **闹钟系统**：设置提醒
- **时间回溯**：特殊道具或剧情需要

### 3. 显示格式
```javascript
// 简洁模式
"3月8日 07:30"

// 详细模式
"第1年 春季 3月8日 星期三 早晨 07:30"

// 带图标模式
"🌸 3月8日 🌅 07:30"

// 状态栏模式
"Y1 春 3/8 07:30"
```

## 🔧 实现计划

### 第一阶段：核心功能
1. ✅ 基础时间推进
2. ⏳ 180天年历系统
3. ⏳ 季节月份计算
4. ⏳ 时间段判断

### 第二阶段：显示优化
1. ⏳ UI时间显示更新
2. ⏳ 季节图标系统
3. ⏳ 格式化选项

### 第三阶段：功能扩展
1. ⏳ 节日系统
2. ⏳ 天气联动
3. ⏳ NPC作息
4. ⏳ 时间相关任务

## 📝 注意事项

1. **存档兼容**：升级时间系统需要考虑旧存档
2. **性能优化**：避免每帧都计算时间
3. **调试工具**：提供时间跳转命令
4. **边界处理**：年末年初的正确过渡

## 🎯 下一步

1. 确认设计方案
2. 备份现有time-system.js
3. 实现新的时间计算逻辑
4. 更新UI显示
5. 测试各种时间推进场景