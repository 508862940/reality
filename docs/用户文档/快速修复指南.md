# 🚨 AI调用问题快速修复指南

## 问题原因
您的 `api-config.js` 文件中 **API_KEY 和 BASE_URL 都是空的**，所以AI无法工作。

## 🔥 立即修复（3种方法）

### 方法1：使用测试工具（最简单）
1. **打开测试页面**：在浏览器打开 `test-ai.html`
2. **填写配置**：
   - API密钥：填入您的密钥
   - API地址：填入代理地址
3. **点击"保存配置"**
4. **点击"测试API"** 验证是否工作
5. **点击"应用到游戏"**

### 方法2：直接修改文件
打开 `api-config.js`，找到第8-12行，修改为：

```javascript
OPENAI_PROXY: {
    // 把下面的值替换成您的真实配置
    API_KEY: 'sk-你的实际密钥',  // ← 这里不能为空！
    BASE_URL: 'https://你的代理地址/v1/chat/completions',  // ← 这里也不能为空！
    MODEL: 'gpt-3.5-turbo'
},
```

### 方法3：浏览器控制台快速配置
1. 打开游戏页面（index.html）
2. 按F12打开控制台
3. 复制粘贴以下代码（替换为您的实际值）：

```javascript
// 直接在控制台运行这段代码
AIConfig.api.openai_proxy.apiKey = 'sk-你的密钥';
AIConfig.api.openai_proxy.baseURL = 'https://你的代理地址/v1/chat/completions';
AIConfig.api.openai_proxy.enabled = true;
AIConfig.currentProvider = 'openai_proxy';

// 同步配置
if (typeof syncAIServiceConfig === 'function') {
    syncAIServiceConfig();
}

// 保存到本地
localStorage.setItem('ai_config', JSON.stringify({
    apiKey: AIConfig.api.openai_proxy.apiKey,
    baseUrl: AIConfig.api.openai_proxy.baseURL,
    model: 'gpt-3.5-turbo'
}));

console.log('✅ 配置已应用！');
```

## 🧪 验证配置是否成功

在控制台运行以下命令查看：

```javascript
// 查看当前配置
console.log('API密钥:', AIConfig.api.openai_proxy.apiKey ? '已配置' : '未配置');
console.log('API地址:', AIConfig.api.openai_proxy.baseURL || '未配置');
console.log('启用状态:', AIConfig.api.openai_proxy.enabled);
```

## 📝 常见API代理服务

如果您还没有API密钥，这里是一些常见的选择：

### OpenAI兼容代理
- **官方OpenAI**: https://api.openai.com/v1/chat/completions
- **第三方代理**: 请咨询您的代理服务商

### 示例配置（请替换为真实值）

```javascript
// 示例1：使用OpenAI官方
OPENAI_PROXY: {
    API_KEY: 'sk-proj-xxxxxxxxxxxxx',
    BASE_URL: 'https://api.openai.com/v1/chat/completions',
    MODEL: 'gpt-3.5-turbo'
}

// 示例2：使用第三方代理
OPENAI_PROXY: {
    API_KEY: 'sk-abc123def456',
    BASE_URL: 'https://api.yourproxy.com/v1/chat/completions',
    MODEL: 'gpt-3.5-turbo'
}
```

## ❓ 还是不行？

### 检查清单
- [ ] API_KEY 是否填写？（不能为空）
- [ ] BASE_URL 是否填写？（不能为空）
- [ ] 密钥是否正确？（检查有无多余空格）
- [ ] 代理地址是否正确？（应该以 /v1/chat/completions 结尾）
- [ ] 网络是否正常？（能否访问代理地址）

### 调试命令集

```javascript
// 1. 检查配置是否加载
console.log(AIConfig.api.openai_proxy);

// 2. 手动测试API
async function testMyAPI() {
    const config = AIConfig.api.openai_proxy;

    if (!config.apiKey || !config.baseURL) {
        console.error('❌ 请先配置 API_KEY 和 BASE_URL');
        return;
    }

    try {
        const response = await fetch(config.baseURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${config.apiKey}`
            },
            body: JSON.stringify({
                model: config.model,
                messages: [{role: 'user', content: '你好'}],
                max_tokens: 50
            })
        });

        if (response.ok) {
            const data = await response.json();
            console.log('✅ API测试成功！', data);
        } else {
            console.error('❌ API错误:', response.status, await response.text());
        }
    } catch (error) {
        console.error('❌ 网络错误:', error);
    }
}

testMyAPI();
```

## 🎯 最简单的解决方案

**使用 test-ai.html 测试工具！**

1. 打开 `test-ai.html`
2. 填写您的API信息
3. 点击测试
4. 成功后应用到游戏

这个工具会：
- 自动保存配置
- 测试API是否可用
- 一键应用到游戏

---

⚠️ **重要提醒**：API_KEY 和 BASE_URL 两个值都必须填写，否则AI功能无法使用！