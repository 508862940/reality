<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··åˆå¯¹è¯ç³»ç»Ÿæµ‹è¯•</title>

    <!-- å¼•å…¥æ¸¸æˆæ ·å¼ -->
    <link rel="stylesheet" href="css/game-main.css">
    <link rel="stylesheet" href="css/f1-dialogue-history.css">
    <link rel="stylesheet" href="css/f2-ai-input.css">

    <style>
        body {
            background: #0f0f23;
            padding: 20px;
            font-family: 'Courier New', monospace;
        }

        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 {
            color: #f093fb;
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .test-description {
            color: #8b92f6;
            text-align: center;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* æµ‹è¯•å¯¹è¯åŒºåŸŸ */
        .dialogue-history-area {
            display: block !important;
            height: 400px;
            background: #0f0f23;
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* æµ‹è¯•æŒ‰é’®ç»„ */
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .test-btn {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background: linear-gradient(135deg, #8b92f6, #f093fb);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }

        .test-btn:active {
            transform: translateY(0);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .section-title {
            color: #fbbf24;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .clear-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            width: 100%;
        }

        /* APIçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: rgba(30, 30, 45, 0.95);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            color: #e4e4e7;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-status.active {
            border-color: #22c55e;
        }

        .api-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
        }

        .api-status.active .api-status-dot {
            background: #22c55e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>âœ¨ æ··åˆå¯¹è¯ç³»ç»Ÿæµ‹è¯•</h1>
        <p class="test-description">æµ‹è¯•æ°”æ³¡æ ·å¼ï¼ˆçº¯å¯¹è¯ï¼‰ä¸æ²‰æµ¸å¼æ ·å¼ï¼ˆå¸¦åŠ¨ä½œï¼‰çš„æ··åˆæ˜¾ç¤º</p>

        <!-- APIçŠ¶æ€æ˜¾ç¤º -->
        <div class="api-status" id="apiStatus">
            <span class="api-status-dot"></span>
            <span>API: <span id="apiStatusText">æœªè¿æ¥</span></span>
        </div>

        <!-- å¯¹è¯å†å²åŒºåŸŸ -->
        <div class="dialogue-history-area active" id="dialogueHistoryArea">
            <!-- å¯¹è¯å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
        </div>

        <!-- æµ‹è¯•æŒ‰é’® -->
        <div class="test-section">
            <div class="section-title">ğŸ“ çº¯å¯¹è¯æµ‹è¯•ï¼ˆæ˜¾ç¤ºæ°”æ³¡ï¼‰</div>
            <div class="test-buttons">
                <button class="test-btn" onclick="sendPureDialogue('player', 'ä½ å¥½ï¼ŒZero')">ç©å®¶ï¼šä½ å¥½</button>
                <button class="test-btn" onclick="sendPureDialogue('npc', '...å—¯ã€‚')">Zeroï¼šç®€çŸ­å›å¤</button>
                <button class="test-btn" onclick="sendPureDialogue('npc', 'æœ‰ä»€ä¹ˆäº‹å—ï¼Ÿéœ€è¦æˆ‘çš„å¸®åŠ©ï¼Ÿ')">Zeroï¼šæ™®é€šå¯¹è¯</button>
                <button class="test-btn" onclick="sendPureDialogue('player', 'æˆ‘æƒ³äº†è§£æ›´å¤šå…³äºè¿™ä¸ªä¸–ç•Œçš„äº‹æƒ…ã€‚')">ç©å®¶ï¼šé•¿å¯¹è¯</button>
            </div>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ­ åŠ¨ä½œ+å¯¹è¯æµ‹è¯•ï¼ˆæ²‰æµ¸å¼æ–‡å­—ï¼‰</div>
            <div class="test-buttons">
                <button class="test-btn" onclick="sendActionDialogue('npc', '*æ²‰é»˜åœ°çœ‹ç€ä½ * ...')">Zeroï¼šå•ä¸ªåŠ¨ä½œ</button>
                <button class="test-btn" onclick="sendActionDialogue('npc', '*è½¬è¿‡èº«çœ‹ç€çª—å¤–* è¿™ä¸ªåŸå¸‚...ä»æ¥æ²¡æœ‰çœŸæ­£çš„å¤œæ™šã€‚')">Zeroï¼šåŠ¨ä½œ+å¯¹è¯</button>
                <button class="test-btn" onclick="sendActionDialogue('player', '*èµ°è¿‘ä¸€æ­¥* ä½ åœ¨æƒ³ä»€ä¹ˆï¼Ÿ')">ç©å®¶ï¼šåŠ¨ä½œ+å¯¹è¯</button>
                <button class="test-btn" onclick="sendComplexDialogue()">å¤æ‚ï¼šå¤šä¸ªåŠ¨ä½œ</button>
            </div>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ”„ æ··åˆæµ‹è¯•</div>
            <div class="test-buttons">
                <button class="test-btn" onclick="sendMixedSequence()">å‘é€æ··åˆåºåˆ—</button>
                <button class="test-btn" onclick="toggleAPIMode()">åˆ‡æ¢APIæ¨¡å¼</button>
                <button class="test-btn clear-btn" onclick="clearDialogue()">æ¸…ç©ºå¯¹è¯</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¯¹è¯ç®¡ç†å™¨ -->
    <script src="js/core/ai-dialogue-manager.js"></script>

    <script>
        // åˆå§‹åŒ–
        let hasAPI = false;

        // æ¨¡æ‹ŸAPIçŠ¶æ€
        window.apiState = {
            hasValidKey: function() {
                return hasAPI;
            }
        };

        // å‘é€çº¯å¯¹è¯ï¼ˆåº”è¯¥æ˜¾ç¤ºä¸ºæ°”æ³¡ï¼‰
        function sendPureDialogue(type, text) {
            const npcName = type === 'npc' ? 'Zero' : null;
            window.aiDialogueManager.displayMessage(type, text, npcName);
        }

        // å‘é€å¸¦åŠ¨ä½œçš„å¯¹è¯ï¼ˆåº”è¯¥æ˜¾ç¤ºä¸ºæ²‰æµ¸å¼æ–‡å­—ï¼‰
        function sendActionDialogue(type, text) {
            const npcName = type === 'npc' ? 'Zero' : null;
            window.aiDialogueManager.displayMessage(type, text, npcName);
        }

        // å‘é€å¤æ‚çš„å¤šåŠ¨ä½œæ¶ˆæ¯
        function sendComplexDialogue() {
            const complexMessage = '*ç«™èµ·èº«* *æ…¢æ…¢èµ°å‘ä½ * *å‡è§†ç€ä½ çš„çœ¼ç›* ä½ çœŸçš„æƒ³çŸ¥é“çœŸç›¸å—ï¼Ÿ';
            window.aiDialogueManager.displayMessage('npc', complexMessage, 'Zero');
        }

        // å‘é€æ··åˆåºåˆ—
        function sendMixedSequence() {
            // æ¸…ç©ºå…ˆ
            clearDialogue();

            setTimeout(() => {
                sendPureDialogue('player', 'å—¨ï¼ŒZeroï¼');
            }, 100);

            setTimeout(() => {
                sendPureDialogue('npc', '...æœ‰äº‹å—ï¼Ÿ');
            }, 600);

            setTimeout(() => {
                sendActionDialogue('player', '*èµ°è¿‘* ä½ çœ‹èµ·æ¥æœ‰å¿ƒäº‹ã€‚');
            }, 1200);

            setTimeout(() => {
                sendActionDialogue('npc', '*è½¬èº«çœ‹å‘çª—å¤–* *æ·±æ·±å¹äº†å£æ°”* åªæ˜¯...æƒ³èµ·äº†ä¸€äº›äº‹ã€‚');
            }, 1800);

            setTimeout(() => {
                sendPureDialogue('player', 'æƒ³èŠèŠå—ï¼Ÿ');
            }, 2400);

            setTimeout(() => {
                sendPureDialogue('npc', '...ä¹Ÿè®¸å§ã€‚');
            }, 3000);
        }

        // æ¸…ç©ºå¯¹è¯
        function clearDialogue() {
            const area = document.getElementById('dialogueHistoryArea');
            if (area) {
                area.innerHTML = '';
            }
        }

        // åˆ‡æ¢APIæ¨¡å¼
        function toggleAPIMode() {
            hasAPI = !hasAPI;
            const status = document.getElementById('apiStatus');
            const statusText = document.getElementById('apiStatusText');

            if (hasAPI) {
                status.classList.add('active');
                statusText.textContent = 'å·²è¿æ¥ï¼ˆæ¨¡æ‹Ÿï¼‰';

                // å‘é€ä¸€æ¡å¸¦APIæ ‡è®°çš„æ¶ˆæ¯
                setTimeout(() => {
                    sendPureDialogue('npc', 'âœ¨ è¿™æ¡æ¶ˆæ¯ä¼šæœ‰APIæ ‡è®°');
                }, 300);
            } else {
                status.classList.remove('active');
                statusText.textContent = 'æœªè¿æ¥';
            }
        }

        // é¡µé¢åŠ è½½åæ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                sendPureDialogue('npc', 'æ¬¢è¿æµ‹è¯•æ··åˆå¯¹è¯ç³»ç»Ÿï¼');
            }, 500);

            setTimeout(() => {
                // è¿™ä¼šåˆ†æˆä¸¤éƒ¨åˆ†æ˜¾ç¤ºï¼šåŠ¨ä½œç”¨æ²‰æµ¸å¼ï¼Œå¯¹è¯ç”¨æ°”æ³¡
                sendActionDialogue('npc', '*å¾®å¾®ç‚¹å¤´* è¯·è¯•è¯•ä¸Šé¢çš„æŒ‰é’®ã€‚');
            }, 1000);
        });
    </script>
</body>
</html>