<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- PWA配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Reality">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3c72">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%238b92f6'/%3E%3Cstop offset='100%25' style='stop-color:%23f093fb'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='180' height='180' fill='url(%23g)'/%3E%3Ctext x='90' y='105' text-anchor='middle' fill='white' font-size='75' font-family='Arial'%3E✨%3C/text%3E%3C/svg%3E">

    <title>Reality - 互动文字冒险游戏</title>
    <!-- PWA适配样式 -->
    <link rel="stylesheet" href="css/app.css">
    <!-- 主菜单样式 -->
    <link rel="stylesheet" href="css/menu.css">
</head>
<body>
    <!-- 动态背景 -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- 主菜单容器 -->
    <div class="main-container pwa-safe-container">
        <h1 class="game-title">✨ Reality ✨</h1>
        <p class="game-subtitle">互动文字冒险游戏</p>

        <div class="menu-buttons">
            <button class="menu-btn primary" id="continueGameBtn" style="display:none">
                ▶️ 继续游戏
            </button>
            <button class="menu-btn" id="newGameBtn">
                🎮 开始新游戏
            </button>
            <button class="menu-btn" id="loadGameBtn">
                💾 载入存档
            </button>
            <button class="menu-btn" id="settingsBtn">
                ⚙️ 游戏设置
            </button>
        </div>

        <div class="version-info">
            Version 0.5 Beta
        </div>
    </div>

    <!-- 设置面板 -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-container">
            <div class="settings-header">
                <div class="settings-title">游戏设置</div>
                <button class="close-btn" id="closeSettingsBtn">×</button>
            </div>

            <div class="settings-content">
                <!-- 游戏预设管理栏 -->
                <div class="preset-management-bar">
                    <div class="preset-selector">
                        <label class="preset-label">当前预设：</label>
                        <select id="game-preset-select" class="preset-select">
                            <option value="default">默认预设</option>
                        </select>
                        <button class="preset-btn" id="new-preset-btn" title="新建预设">➕</button>
                        <button class="preset-btn" id="rename-preset-btn" title="重命名">📝</button>
                        <button class="preset-btn" id="delete-preset-btn" title="删除预设">🗑️</button>
                    </div>
                    <div class="preset-actions">
                        <button class="setting-btn save-preset" id="save-preset-btn">💾 保存当前预设</button>
                        <button class="preset-btn" id="export-preset-btn" title="导出预设">📤</button>
                        <button class="preset-btn" id="import-preset-btn" title="导入预设">📥</button>
                        <input type="file" id="import-preset-file" accept=".json" style="display:none">
                    </div>
                </div>

                <!-- API设置 - 使用新的预设管理系统 -->
                <div class="settings-section">
                    <div class="section-title">🤖 API 设置</div>
                    <div id="api-settings-container">
                        <!-- 显示当前预设信息 -->
                        <div id="current-preset-info" class="preset-info"></div>
                        <button class="setting-btn" id="openAPISettingsBtn">配置AI服务</button>
                    </div>
                </div>

                <!-- 角色预设 -->
                <div class="settings-section">
                    <div class="section-title">👤 角色预设</div>
                    <div class="setting-item">
                        <span class="setting-label">默认性别</span>
                        <select class="setting-select" id="default-gender">
                            <option value="">游戏时选择</option>
                            <option value="male">男性</option>
                            <option value="female">女性</option>
                            <option value="futanari">扶她</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">默认体型</span>
                        <select class="setting-select" id="default-body-type">
                            <option value="">游戏时选择</option>
                            <option value="small">小体型（灵活）</option>
                            <option value="medium">中体型（平衡）</option>
                            <option value="large">大体型（强壮）</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">属性点模式</span>
                        <select class="setting-select" id="stat-mode">
                            <option value="balanced">平衡分配</option>
                            <option value="custom">自定义分配</option>
                            <option value="random">随机分配</option>
                        </select>
                    </div>
                    <button class="setting-btn" id="customize-stats-btn">⚙️ 自定义初始属性</button>
                </div>

                <!-- 游戏设置 -->
                <div class="settings-section">
                    <div class="section-title">🎮 游戏设置</div>
                    <div class="setting-item">
                        <span class="setting-label">难度</span>
                        <select class="setting-select" id="difficulty-select" aria-label="难度选择">
                            <option value="easy">简单</option>
                            <option value="normal" selected>普通</option>
                            <option value="hard">困难</option>
                            <option value="nightmare">噩梦</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">自动存档</span>
                        <div class="toggle-switch active" data-setting="autoSave">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">跳过教程</span>
                        <div class="toggle-switch" data-setting="skipTutorial">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">显示提示</span>
                        <div class="toggle-switch active" data-setting="showHints">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <!-- 音量设置 -->
                <div class="settings-section">
                    <div class="section-title">🔊 音量设置</div>
                    <div class="setting-item">
                        <span class="setting-label">主音量</span>
                        <input type="range" class="volume-slider" id="volume-master" min="0" max="100" value="70" aria-label="主音量">
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">音效</span>
                        <input type="range" class="volume-slider" id="volume-sfx" min="0" max="100" value="80" aria-label="音效音量">
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">背景音乐</span>
                        <input type="range" class="volume-slider" id="volume-bgm" min="0" max="100" value="50" aria-label="背景音乐音量">
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">语音</span>
                        <input type="range" class="volume-slider" id="volume-voice" min="0" max="100" value="90" aria-label="语音音量">
                    </div>
                </div>

                <!-- 扩展包设置 -->
                <div class="settings-section">
                    <div class="section-title">📦 扩展包设置</div>
                    <div class="expansion-list">
                        <div class="expansion-item">
                            <span class="expansion-name">🏫 校园生活扩展包</span>
                            <span class="expansion-status">已启用</span>
                        </div>
                        <div class="expansion-item">
                            <span class="expansion-name">🌃 都市冒险扩展包</span>
                            <span class="expansion-status disabled">未安装</span>
                        </div>
                        <div class="expansion-item">
                            <span class="expansion-name">🎪 节日活动扩展包</span>
                            <span class="expansion-status disabled">未安装</span>
                        </div>
                        <div class="expansion-item">
                            <span class="expansion-name">💼 职场生涯扩展包</span>
                            <span class="expansion-status disabled">即将推出</span>
                        </div>
                    </div>
                </div>

                <!-- 世界设置 -->
                <div class="settings-section">
                    <div class="section-title">🌍 世界设置</div>
                    <div class="setting-item">
                        <span class="setting-label">开局季节</span>
                        <select class="setting-select" id="start-season">
                            <option value="spring">春天</option>
                            <option value="summer">夏天</option>
                            <option value="autumn">秋天</option>
                            <option value="winter">冬天</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">NPC密度</span>
                        <select class="setting-select" id="npc-density">
                            <option value="sparse">稀少</option>
                            <option value="normal" selected>普通</option>
                            <option value="crowded">繁多</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">经济难度</span>
                        <select class="setting-select" id="economy-difficulty">
                            <option value="easy">宽松</option>
                            <option value="normal" selected>标准</option>
                            <option value="hard">紧缩</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">时间流速</span>
                        <select class="setting-select" id="time-speed">
                            <option value="0.5">慢速 (0.5x)</option>
                            <option value="1" selected>正常 (1x)</option>
                            <option value="2">快速 (2x)</option>
                        </select>
                    </div>
                </div>

                <!-- NPC设置 -->
                <div class="settings-section">
                    <div class="section-title">👥 NPC设置</div>
                    <div class="setting-item">
                        <span class="setting-label">重要NPC个性</span>
                        <select class="setting-select" id="important-npc-personality">
                            <option value="canonical" selected>原作设定</option>
                            <option value="randomized">随机化</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">NPC记忆深度</span>
                        <select class="setting-select" id="npc-memory-depth">
                            <option value="shallow">浅层（5条）</option>
                            <option value="normal" selected>标准（20条）</option>
                            <option value="deep">深度（50条）</option>
                        </select>
                    </div>
                    <button class="setting-btn" id="customize-npcs-btn">⚙️ 自定义重要NPC</button>
                </div>

                <!-- 美化模组 -->
                <div class="settings-section">
                    <div class="section-title">🎨 美化模组</div>
                    <div class="setting-item">
                        <span class="setting-label">UI主题</span>
                        <select class="setting-select" id="ui-theme">
                            <option value="default" selected>默认紫色</option>
                            <option value="dark">深色模式</option>
                            <option value="light">浅色模式</option>
                            <option value="cyberpunk">赛博朋克</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">字体大小</span>
                        <select class="setting-select" id="font-size">
                            <option value="small">小</option>
                            <option value="normal" selected>标准</option>
                            <option value="large">大</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">动画效果</span>
                        <div class="toggle-switch active" data-setting="animations">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- API配置模态框（使用原有的） -->
    <div id="api-config-modal" class="modal-overlay hidden">
        <!-- 这里会动态加载原有的API配置界面 -->
    </div>

    <!-- 加载必要的脚本 -->
    <!-- Dexie.js for IndexedDB -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
    <!-- Database module -->
    <script src="js/core/database.js"></script>
    <!-- 统一的存档系统 -->
    <script src="js/core/save-system.js"></script>
    <!-- 游戏预设管理系统 -->
    <script src="js/core/game-preset-manager.js"></script>
    <script src="js/pages/menu.js"></script>
    <!-- API预设管理系统 -->
    <script src="js/api/api-preset-manager.js"></script>
    <script src="js/api/api-settings-screen.js"></script>
    <!-- API状态管理 -->
    <script src="js/api/api-state.js"></script>
    <!-- 注意：api-settings-ui.js 和 api-settings-screen.js 可能有冲突，暂时禁用旧版本 -->
    <!-- <script src="js/api/api-settings-ui.js"></script> -->
    <script>
        // 页面加载完成后更新预设信息
        window.addEventListener('DOMContentLoaded', function() {
            updatePresetInfo();
        });
    </script>
</body>
</html>